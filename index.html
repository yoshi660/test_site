<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ピクセル西湖 RUN! | マリオ風ゲーム</title>
  <meta name="description" content="西湖のホームページがマリオ風ランゲームに変身。スペースかタップでジャンプしながらピクセル西湖を駆け抜けよう。" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=M+PLUS+Rounded+1c:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --sky-top: #bce1ff;
      --sky-bottom: #6ab6ff;
      --ground: #d67733;
      --ground-dark: #b25b1e;
      --pipe: #2ebd66;
      --pipe-dark: #198f3e;
      --text: #0b1f4a;
      --shadow: rgba(15, 23, 42, 0.25);
      --accent: #ffd166;
      font-family: 'Press Start 2P', 'M PLUS Rounded 1c', 'Noto Sans JP', system-ui, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at 20% 20%, #0d1a4a 0%, #0d1a4a 24%, #0a1437 60%, #050d26 100%);
      line-height: 1.6;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.5rem;
      color: var(--text);
    }
    header.hero {
      width: 100%;
      max-width: 1100px;
      background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
      border: 4px solid #1e2f68;
      border-radius: 18px;
      padding: 1.25rem 1.5rem;
      box-shadow: 0 20px 50px rgba(0,0,0,0.35);
      backdrop-filter: blur(6px);
      position: relative;
      overflow: hidden;
    }
    .hero::before, .hero::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      filter: blur(20px);
      opacity: 0.2;
    }
    .hero::before {
      width: 220px; height: 220px;
      background: #5ce1e6;
      top: -80px; left: -40px;
    }
    .hero::after {
      width: 260px; height: 260px;
      background: #ff8e53;
      bottom: -120px; right: -60px;
    }
    .hero .badge {
      display: inline-flex;
      gap: 0.35rem;
      align-items: center;
      font-size: 0.8rem;
      background: #0f1f4f;
      color: #e0edff;
      padding: 0.35rem 0.75rem;
      border-radius: 999px;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.08);
      letter-spacing: 0.04em;
    }
    .hero h1 {
      margin: 0.6rem 0 0.35rem;
      font-size: clamp(1.6rem, 3vw, 2.25rem);
      letter-spacing: 0.06em;
      text-shadow: 0 4px 0 #f9f3df, 0 10px 20px rgba(0,0,0,0.35);
    }
    .hero p {
      margin: 0.25rem 0 0.75rem;
      font-size: 0.95rem;
      max-width: 680px;
    }
    .hero .cta {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }
    .hero button {
      font-family: inherit;
      border: 0;
      background: linear-gradient(180deg, #ffd166 0%, #ff9f1c 100%);
      color: #10224d;
      padding: 0.9rem 1.4rem;
      border-radius: 12px;
      font-size: 0.9rem;
      cursor: pointer;
      box-shadow: 0 12px 0 #c47011, 0 20px 30px rgba(0,0,0,0.35);
      transition: transform 120ms ease, box-shadow 120ms ease;
    }
    .hero button:hover { transform: translateY(-2px); box-shadow: 0 14px 0 #c47011, 0 22px 32px rgba(0,0,0,0.4); }
    .hero button:active { transform: translateY(4px); box-shadow: 0 6px 0 #c47011, 0 10px 18px rgba(0,0,0,0.35); }
    .hint {
      font-size: 0.8rem;
      color: #e9f2ff;
      letter-spacing: 0.08em;
    }
    main {
      width: 100%;
      max-width: 1100px;
      margin-top: 1.5rem;
      display: grid;
      gap: 1rem;
    }
    .game-section {
      background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.04));
      border: 4px solid #1e2f68;
      border-radius: 18px;
      padding: 1rem;
      box-shadow: 0 18px 50px rgba(0,0,0,0.4);
    }
    .scoreboard {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 0.75rem;
    }
    .scoreboard .stat {
      background: #0f1f4f;
      color: #f8f6ff;
      padding: 0.65rem 0.9rem;
      border-radius: 12px;
      border: 2px solid #1e2f68;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.08), 0 10px 16px rgba(0,0,0,0.25);
      min-width: 140px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
    }
    .stat .label { letter-spacing: 0.08em; color: #9bc4ff; }
    .stat .value { font-size: 1.1rem; }
    .game {
      position: relative;
      overflow: hidden;
      width: 100%;
      max-width: 1040px;
      aspect-ratio: 16 / 9;
      margin: 0 auto;
      background: linear-gradient(180deg, var(--sky-top) 0%, var(--sky-bottom) 60%, var(--ground) 60%, var(--ground-dark) 100%);
      border: 6px solid #1e2f68;
      border-radius: 16px;
      box-shadow: inset 0 -6px 0 rgba(0,0,0,0.14), 0 18px 45px rgba(0,0,0,0.45);
      touch-action: manipulation;
    }
    .game::before, .game::after {
      content: "";
      position: absolute;
      left: 0; right: 0;
    }
    .game::before {
      bottom: 76px;
      height: 12px;
      background: repeating-linear-gradient(90deg, rgba(0,0,0,0.15) 0 18px, transparent 18px 36px);
      opacity: 0.6;
    }
    .game::after {
      bottom: 0;
      height: 76px;
      background: repeating-linear-gradient(-45deg, #c96d2d 0 16px, #b0561a 16px 32px);
      border-top: 6px solid #aa4c16;
    }
    .cloud {
      position: absolute;
      background: #fff;
      border: 3px solid #d0e5ff;
      border-radius: 24px;
      box-shadow:
        18px -6px 0 -4px #fff,
        36px 6px 0 -6px #fff,
        54px -4px 0 -8px #fff,
        0 0 0 3px #d0e5ff inset;
      animation: float-cloud 24s linear infinite;
    }
    .cloud.small { width: 90px; height: 46px; top: 14%; left: 12%; animation-delay: -3s; }
    .cloud.medium { width: 140px; height: 56px; top: 26%; left: 52%; animation-delay: -10s; }
    .cloud.large { width: 170px; height: 64px; top: 10%; left: 72%; animation-delay: -16s; }
    @keyframes float-cloud {
      from { transform: translateX(0); }
      to { transform: translateX(-140%); }
    }
    .hill {
      position: absolute;
      bottom: 60px;
      width: 280px; height: 180px;
      background: radial-gradient(ellipse at center, #7ed957 0%, #57b447 65%, #2e7d32 100%);
      border: 6px solid #195b24;
      border-radius: 50% 50% 10px 10px;
      box-shadow: inset 0 -14px rgba(0,0,0,0.18);
      transform: scaleX(1.1);
      opacity: 0.9;
    }
    .hill.right { right: -60px; }
    .hill.left { left: -50px; transform: scaleX(1.15) scaleY(0.92); opacity: 0.8; }
    .mario {
      position: absolute;
      left: 120px;
      bottom: 76px;
      width: 46px;
      height: 46px;
      background: linear-gradient(180deg, #d62b39 0 34%, #1c7ed6 34% 74%, #f4c542 74% 100%);
      border: 4px solid #132b58;
      border-radius: 8px 8px 6px 6px;
      box-shadow: 0 10px 0 rgba(0,0,0,0.16);
      transform-origin: center;
      transition: filter 120ms ease;
    }
    .mario::before {
      content: "";
      position: absolute;
      top: -16px; left: 6px;
      width: 36px; height: 16px;
      background: #d62b39;
      border: 4px solid #132b58;
      border-bottom: none;
      border-radius: 6px 6px 0 0;
    }
    .mario::after {
      content: "";
      position: absolute;
      top: 16px; left: 10px;
      width: 12px; height: 12px;
      background: #f9e9a3;
      box-shadow: 14px 0 0 #f9e9a3;
      border-radius: 2px;
    }
    .obstacles { position: absolute; inset: 0; }
    .pipe {
      position: absolute;
      bottom: 76px;
      width: 72px; height: 120px;
      background: linear-gradient(180deg, var(--pipe) 0%, #20a653 60%, var(--pipe-dark) 100%);
      border: 6px solid #0f5e27;
      border-radius: 12px 12px 6px 6px;
      box-shadow: inset 0 -12px rgba(0,0,0,0.14);
    }
    .pipe::before {
      content: "";
      position: absolute;
      top: -26px; left: -8px;
      width: 88px; height: 30px;
      background: linear-gradient(180deg, #43d36b 0%, #1fa152 90%);
      border: 6px solid #0f5e27;
      border-radius: 12px 12px 0 0;
      box-shadow: inset 0 -8px rgba(0,0,0,0.14);
    }
    .brick-row {
      position: absolute;
      top: 32%;
      left: 14%;
      display: flex;
      gap: 6px;
      transform: translateZ(0);
    }
    .brick {
      width: 52px; height: 52px;
      background: repeating-linear-gradient(-45deg, #ad5a26 0 12px, #9b4117 12px 24px);
      border: 4px solid #6a2307;
      border-radius: 6px;
      box-shadow: inset 0 -10px rgba(0,0,0,0.18);
      animation: bob 1.4s ease-in-out infinite;
    }
    .brick:nth-child(2) { animation-delay: 0.15s; }
    .brick:nth-child(3) { animation-delay: 0.3s; }
    @keyframes bob { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
    .legend {
      margin-top: 0.9rem;
      padding: 0.75rem 0.9rem;
      background: #0f1f4f;
      color: #e7efff;
      border-radius: 12px;
      border: 2px solid #1e2f68;
      font-size: 0.85rem;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,0.08);
    }
    .legend strong { color: #ffd166; }
    .status-overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
      text-align: center;
      color: #0f1f4f;
      text-shadow: 0 3px 0 #f9f3df, 0 12px 30px rgba(0,0,0,0.35);
      font-size: clamp(1.3rem, 4vw, 2.1rem);
      font-weight: 700;
      opacity: 0;
      transition: opacity 180ms ease;
    }
    .status-overlay.show { opacity: 1; }
    @media (max-width: 800px) {
      body { padding: 1rem; }
      .scoreboard .stat { min-width: 120px; }
      .game { aspect-ratio: 4 / 3; }
      .hero h1 { font-size: 1.5rem; }
      .hero p { font-size: 0.85rem; }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="badge">PIXEL WEST LAKE</div>
    <h1>マリオ風ランゲームで西湖を駆けろ！</h1>
    <p>スペースキーかタップでジャンプ。ピクセル西湖を走り抜け、パイプをかわしてハイスコアを狙おう。</p>
    <div class="cta">
      <button id="startBtn">スタート</button>
      <span class="hint">SPACE / クリック / タップ</span>
    </div>
  </header>
  <main>
    <section class="game-section">
      <div class="scoreboard">
        <div class="stat"><span class="label">SCORE</span><span class="value" id="score">0000</span></div>
        <div class="stat"><span class="label">BEST</span><span class="value" id="bestScore">0000</span></div>
        <div class="stat"><span class="label">STATE</span><span class="value" id="status">READY</span></div>
      </div>
      <div class="game" id="game">
        <div class="cloud small"></div>
        <div class="cloud medium"></div>
        <div class="cloud large"></div>
        <div class="hill left"></div>
        <div class="hill right"></div>
        <div class="brick-row">
          <div class="brick"></div>
          <div class="brick"></div>
          <div class="brick"></div>
        </div>
        <div class="obstacles" id="obstacles"></div>
        <div class="mario" id="mario"></div>
        <div class="status-overlay" id="overlay">READY</div>
      </div>
      <div class="legend">
        <strong>遊び方:</strong> スペースキー、クリック、タップのいずれかでジャンプ。障害物に当たると終了。ゲーム画面を押すと再スタートできます。
      </div>
    </section>
  </main>
  <script>
    (() => {
      const game = document.getElementById('game');
      const mario = document.getElementById('mario');
      const obstaclesEl = document.getElementById('obstacles');
      const startBtn = document.getElementById('startBtn');
      const scoreEl = document.getElementById('score');
      const bestEl = document.getElementById('bestScore');
      const statusEl = document.getElementById('status');
      const overlay = document.getElementById('overlay');

      let state = 'ready';
      let isJumping = false;
      let velocity = 0;
      let positionY = 0;
      let obstacles = [];
      let score = 0;
      let bestScore = 0;
      let lastTime = null;
      let spawnTimer = 0;

      const gravity = 0.8;
      const groundLevel = 76;

      const formatScore = (val) => String(Math.floor(val)).padStart(4, '0');

      function updateScore(val) {
        scoreEl.textContent = formatScore(val);
      }

      function setOverlay(text, visible) {
        overlay.textContent = text;
        overlay.classList.toggle('show', visible);
      }

      function resetGame() {
        obstacles.forEach(o => o.el.remove());
        obstacles = [];
        score = 0;
        spawnTimer = 0;
        velocity = 0;
        positionY = 0;
        mario.style.transform = 'translateY(0)';
        updateScore(0);
        statusEl.textContent = 'READY';
        setOverlay('READY', true);
      }

      function startGame() {
        resetGame();
        state = 'playing';
        statusEl.textContent = 'RUN!';
        setOverlay('', false);
        lastTime = null;
        requestAnimationFrame(loop);
      }

      function endGame() {
        state = 'gameover';
        bestScore = Math.max(bestScore, Math.floor(score));
        bestEl.textContent = formatScore(bestScore);
        statusEl.textContent = 'GAME OVER';
        setOverlay('GAME OVER - 画面を押して再開', true);
        mario.style.filter = 'grayscale(0.3) brightness(0.9)';
      }

      function spawnPipe() {
        const pipe = document.createElement('div');
        pipe.className = 'pipe';
        const startX = game.clientWidth + 80;
        pipe.style.transform = `translateX(${startX}px)`;
        obstaclesEl.appendChild(pipe);
        obstacles.push({ el: pipe, x: startX });
      }

      function jump() {
        if (state !== 'playing') {
          startGame();
          return;
        }
        if (isJumping) return;
        isJumping = true;
        velocity = -16;
        mario.style.filter = 'brightness(1.1)';
        setTimeout(() => mario.style.filter = 'none', 150);
      }

      function collide(rect1, rect2) {
        return !(
          rect1.right < rect2.left ||
          rect1.left > rect2.right ||
          rect1.bottom < rect2.top ||
          rect1.top > rect2.bottom
        );
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        const delta = (timestamp - lastTime) / 16.67; // normalize to ~60fps step
        lastTime = timestamp;

        if (state !== 'playing') return;

        // Jump physics
        if (isJumping) {
          velocity += gravity * delta;
          positionY += velocity * delta;
          if (positionY > 0) {
            positionY = 0;
            velocity = 0;
            isJumping = false;
          }
          mario.style.transform = `translateY(${positionY}px)`;
        }

        // Spawn & move pipes
        spawnTimer += delta;
        const speed = 5 + Math.min(score / 240, 4);
        if (spawnTimer > Math.max(24 - score * 0.01, 16)) {
          spawnPipe();
          spawnTimer = 0;
        }

        obstacles = obstacles.filter(obj => {
          obj.x -= speed * delta * 3.4;
          obj.el.style.transform = `translateX(${obj.x}px)`;
          return obj.x > -140;
        });

        // Collision check
        const marioRect = mario.getBoundingClientRect();
        for (const obj of obstacles) {
          const pipeRect = obj.el.getBoundingClientRect();
          if (collide(marioRect, pipeRect)) {
            endGame();
            return;
          }
        }

        // Score
        score += 0.6 * delta;
        updateScore(score);

        requestAnimationFrame(loop);
      }

      startBtn.addEventListener('click', startGame);
      game.addEventListener('pointerdown', jump);
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' || e.key === ' ') {
          e.preventDefault();
          jump();
        }
      });
      resetGame();
    })();
  </script>
</body>
</html>
